#!/bin/zsh
source ~/.zsh_secrets 2>/dev/null
[[ -f ~/.fzf.zsh ]] && source ~/.fzf.zsh
[[ -d /opt/homebrew/bin ]] && export PATH="/opt/homebrew/bin:$PATH"

selected=$(
    { find "$HOME/Projects" -mindepth 1 -maxdepth 1 -type d
      find "$HOME/Projects/cpi" -mindepth 1 -maxdepth 1 -type d 2>/dev/null
      echo "$HOME/dotfiles"
      [[ -n "$vault" ]] && echo "$vault"
    } | fzf --prompt="  "
)
[ -z "$selected" ] && exit 0

name=$(basename "$selected" | tr '. ' '__')

if ! tmux has-session -t "$name" 2>/dev/null; then
    tmux new-session -d -s "$name" -c "$selected"
    tmux new-window -t "$name" -c "$selected"
    tmux new-window -t "$name" -c "$selected"
    tmux link-window -s default:9 -t "$name":9 2>/dev/null || true
    tmux select-window -t "$name":1
fi

tmux switch-client -t "$name"
